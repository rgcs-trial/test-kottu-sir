{
  "version": 1,
  "project_name": "restaurant-saas",
  "production_branch": "main",
  "preview_branches": ["develop", "staging"],
  "build": {
    "command": "npm run build:cloudflare",
    "destination_dir": ".open-next",
    "root_dir": ".",
    "env_vars": {
      "NODE_VERSION": "18.17.0",
      "NPM_VERSION": "9.6.7",
      "SKIP_DEPENDENCY_INSTALL": "true"
    }
  },
  "deployment": {
    "compatibility_date": "2024-09-23",
    "compatibility_flags": ["nodejs_compat"],
    "env_vars": {
      "production": {
        "NODE_ENV": "production",
        "ENVIRONMENT": "production",
        "NEXT_PUBLIC_APP_URL": "https://restaurantsaas.com",
        "NEXT_PUBLIC_CDN_URL": "https://cdn.restaurantsaas.com"
      },
      "preview": {
        "NODE_ENV": "staging",
        "ENVIRONMENT": "staging",
        "NEXT_PUBLIC_APP_URL": "https://staging.restaurantsaas.com",
        "NEXT_PUBLIC_CDN_URL": "https://cdn-staging.restaurantsaas.com"
      }
    },
    "kv_namespaces": {
      "production": [
        {
          "binding": "SESSION_KV",
          "namespace_id": "restaurant-saas-sessions-prod"
        },
        {
          "binding": "CACHE_KV",
          "namespace_id": "restaurant-saas-cache-prod"
        },
        {
          "binding": "RATE_LIMIT_KV",
          "namespace_id": "restaurant-saas-ratelimit-prod"
        }
      ],
      "preview": [
        {
          "binding": "SESSION_KV",
          "namespace_id": "restaurant-saas-sessions-staging"
        },
        {
          "binding": "CACHE_KV",
          "namespace_id": "restaurant-saas-cache-staging"
        },
        {
          "binding": "RATE_LIMIT_KV",
          "namespace_id": "restaurant-saas-ratelimit-staging"
        }
      ]
    },
    "r2_buckets": {
      "production": [
        {
          "binding": "ASSETS_BUCKET",
          "bucket_name": "restaurant-saas-assets-prod"
        },
        {
          "binding": "UPLOADS_BUCKET",
          "bucket_name": "restaurant-saas-uploads-prod"
        },
        {
          "binding": "CACHE_BUCKET",
          "bucket_name": "restaurant-saas-cache-prod"
        }
      ],
      "preview": [
        {
          "binding": "ASSETS_BUCKET",
          "bucket_name": "restaurant-saas-assets-staging"
        },
        {
          "binding": "UPLOADS_BUCKET",
          "bucket_name": "restaurant-saas-uploads-staging"
        },
        {
          "binding": "CACHE_BUCKET",
          "bucket_name": "restaurant-saas-cache-staging"
        }
      ]
    },
    "durable_objects": [
      {
        "name": "ORDER_TRACKER",
        "class_name": "OrderTracker",
        "script_name": "restaurant-saas"
      },
      {
        "name": "NOTIFICATION_MANAGER",
        "class_name": "NotificationManager",
        "script_name": "restaurant-saas"
      }
    ],
    "queues": {
      "production": [
        {
          "binding": "EMAIL_QUEUE",
          "queue_name": "restaurant-email-notifications"
        },
        {
          "binding": "ORDER_QUEUE",
          "queue_name": "restaurant-order-processing"
        },
        {
          "binding": "ANALYTICS_QUEUE",
          "queue_name": "restaurant-analytics"
        }
      ],
      "preview": [
        {
          "binding": "EMAIL_QUEUE",
          "queue_name": "restaurant-email-notifications-staging"
        },
        {
          "binding": "ORDER_QUEUE",
          "queue_name": "restaurant-order-processing-staging"
        },
        {
          "binding": "ANALYTICS_QUEUE",
          "queue_name": "restaurant-analytics-staging"
        }
      ]
    },
    "analytics_engine": [
      {
        "binding": "ANALYTICS",
        "dataset": "restaurant_saas_analytics"
      }
    ]
  },
  "functions": {
    "directory": "functions",
    "env_vars": {
      "production": {
        "WORKER_ENV": "production"
      },
      "preview": {
        "WORKER_ENV": "staging"
      }
    }
  },
  "headers": {
    "/*": {
      "X-Frame-Options": "DENY",
      "X-Content-Type-Options": "nosniff",
      "Referrer-Policy": "origin-when-cross-origin",
      "Permissions-Policy": "camera=(), microphone=(), geolocation=()",
      "Strict-Transport-Security": "max-age=31536000; includeSubDomains; preload"
    },
    "/_next/static/*": {
      "Cache-Control": "public, max-age=31536000, immutable"
    },
    "/api/*": {
      "Cache-Control": "no-cache, no-store, must-revalidate"
    },
    "/favicon.ico": {
      "Cache-Control": "public, max-age=86400"
    },
    "/robots.txt": {
      "Cache-Control": "public, max-age=86400"
    },
    "/manifest.json": {
      "Cache-Control": "public, max-age=86400"
    }
  },
  "redirects": [
    {
      "source": "/admin",
      "destination": "/admin/dashboard",
      "status": 302
    },
    {
      "source": "/dashboard",
      "destination": "/dashboard/overview",
      "status": 302
    },
    {
      "source": "/app",
      "destination": "/dashboard",
      "status": 301
    }
  ],
  "routes": {
    "production": [
      {
        "pattern": "restaurantsaas.com/*",
        "zone_name": "restaurantsaas.com"
      },
      {
        "pattern": "*.restaurantsaas.com/*",
        "zone_name": "restaurantsaas.com"
      },
      {
        "pattern": "www.restaurantsaas.com/*",
        "zone_name": "restaurantsaas.com"
      }
    ],
    "preview": [
      {
        "pattern": "staging.restaurantsaas.com/*",
        "zone_name": "restaurantsaas.com"
      },
      {
        "pattern": "*.staging.restaurantsaas.com/*",
        "zone_name": "restaurantsaas.com"
      }
    ]
  },
  "custom_domains": {
    "production": [
      "restaurantsaas.com",
      "www.restaurantsaas.com",
      "app.restaurantsaas.com"
    ],
    "preview": [
      "staging.restaurantsaas.com",
      "preview.restaurantsaas.com"
    ]
  },
  "security": {
    "waf": {
      "enabled": true,
      "rules": [
        {
          "expression": "cf.threat_score gt 14",
          "action": "block"
        },
        {
          "expression": "http.request.uri.path contains \"/api/\" and rate(1m) > 100",
          "action": "challenge"
        },
        {
          "expression": "http.request.uri.path eq \"/admin\" and not ip.src in {192.168.0.0/16 10.0.0.0/8 172.16.0.0/12}",
          "action": "challenge"
        }
      ]
    },
    "bot_management": {
      "enabled": true,
      "fight_mode": "on"
    },
    "ddos_protection": {
      "enabled": true,
      "sensitivity": "high"
    },
    "rate_limiting": {
      "enabled": true,
      "rules": [
        {
          "match": "/api/auth/*",
          "threshold": 10,
          "period": 60,
          "action": "block"
        },
        {
          "match": "/api/orders",
          "threshold": 50,
          "period": 60,
          "action": "challenge"
        },
        {
          "match": "/api/*",
          "threshold": 100,
          "period": 60,
          "action": "log"
        }
      ]
    }
  },
  "performance": {
    "caching": {
      "browser_cache_ttl": 31536000,
      "edge_cache_ttl": 7200,
      "always_online": true,
      "development_mode": false
    },
    "minification": {
      "css": true,
      "html": true,
      "js": true
    },
    "compression": {
      "enabled": true,
      "algorithms": ["gzip", "brotli"]
    },
    "rocket_loader": false,
    "mirage": true,
    "polish": "lossy",
    "webp": true
  },
  "monitoring": {
    "real_user_monitoring": {
      "enabled": true
    },
    "web_analytics": {
      "enabled": true
    },
    "speed_insights": {
      "enabled": true
    }
  },
  "notifications": {
    "deployment_success": {
      "webhook_url": "https://hooks.slack.com/your-deployment-webhook",
      "email": "devops@restaurantsaas.com"
    },
    "deployment_failure": {
      "webhook_url": "https://hooks.slack.com/your-failure-webhook",
      "email": "devops@restaurantsaas.com"
    }
  },
  "preview_deployments": {
    "enabled": true,
    "include_preview_only": false,
    "alias_branches": {
      "develop": "dev.restaurantsaas.com",
      "staging": "staging.restaurantsaas.com"
    }
  },
  "access_control": {
    "ip_whitelist": {
      "admin_paths": [
        "/admin/*"
      ],
      "allowed_ips": [
        "192.168.1.0/24",
        "10.0.0.0/8"
      ]
    },
    "geo_blocking": {
      "enabled": false,
      "allowed_countries": ["US", "CA", "GB", "AU", "DE", "FR", "IT", "ES"],
      "blocked_countries": []
    }
  },
  "ssl": {
    "mode": "strict",
    "min_tls_version": "1.2",
    "certificate_transparency": true,
    "hsts": {
      "enabled": true,
      "max_age": 31536000,
      "include_subdomains": true,
      "preload": true
    }
  }
}